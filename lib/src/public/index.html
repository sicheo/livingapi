<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Getting Started</title>
    <script src="script/dist/brouser.bundle.js"></script>
</head>
<body>
    <script>
        const baseapiurl = "http://127.0.0.1:3132/living/v1/convergence";
        const convergenceurl = "http://192.168.43.26/api/realtime/convergence/living"

        const apiconn = new window.ConvApp.JwtApi(baseapiurl);

        const jwtconn = new window.ConvApp.JwtConnection(convergenceurl, apiconn);

        const userjwt = new window.ConvApp.Brouser("giulio.stumpo@gmail.com", jwtconn);

        const opts = { user: "giulio.stumpo@gmail.com", password: "password" };

        const userlist = ["carlotta.garlanda@livingnet.eu", "eleonora.decaroli@livingnet.eu"]

        userjwt.emitter.on("connected", (userpwd) => {
            console.log("EVENT: " + userjwt.id + " connected")
        })

        userjwt.emitter.on("disconnected", (id) => {
            console.log("EVENT: " + id + " disconnected")
        })

        userjwt.emitter.on("error", (error) => {
            console.log("ERROR: " + userjwt.id + " " + error)
        })

        userjwt.emitter.on("state_set", (ret) => {
            console.log("EVENT: " + userjwt.id + " statuschange: " + JSON.stringify(ret))
        })

        userjwt.connect(opts)
            .then((domain) => {
                userjwt.subscribe()
                    .then((subscriptions) => {
                        userjwt.unsubscribe("eleonora.decaroli@livingnet.eu")
                        userjwt.disconnect()
                    })
            })
            .catch((error) => {
                console.log((error))
            })
    </script>
</body>
</html>