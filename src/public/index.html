<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Getting Started</title>
    <script src="script/dist/brouser.bundle.js"></script>
</head>
<body>
    <script>
        const authurl = "http://127.0.0.1:3132/living/v1/convergence/token";
        const convergenceurl = "http://192.168.43.26/api/realtime/convergence/living"

        const authconn = new window.ConvApp.JwtAuthentication(authurl);

        const jwtconn = new window.ConvApp.JwtConnection(convergenceurl, authconn);

        const userjwt = new window.ConvApp.Brouser("JWT Connection", jwtconn);

        const opts = { user: "giulio.stumpo@gmail.com", password: "password" };

        const userlist = ["carlotta.garlanda@livingnet.eu", "eleonora.decaroli@livingnet.eu"]

        userjwt.emitter.on("connected", (userpwd) => {
            console.log("EVENT: " + userjwt.id + " connected")
        })

        userjwt.emitter.on("disconnected", (id) => {
            console.log("EVENT: " + id + " disconnected")
        })

        userjwt.emitter.on("error", (error) => {
            console.log("ERROR: " + userjwt.id + " " + error)
        })

        userjwt.emitter.on("subscribed", (subscriptions) => {
            let subscribed = ""
            for (let i = 0; i < subscriptions.length; i++)
                subscribed += " " + subscriptions[i].user.username
            console.log("EVENT: " + userjwt.id + " subscribed: " + subscribed)
        })
        userjwt.emitter.on("unsubscribed", (username) => {
            console.log("EVENT: " + userjwt.id + " unsubscribed: " + username)
        })

        userjwt.connect(opts)
            .then((domain) => {
                userjwt.subscribe(userlist)
                    .then((subscriptions) => {
                        userjwt.unsubscribe("eleonora.decaroli@livingnet.eu")
                        userjwt.disconnect()
                    })
            })
            .catch((error) => {
                console.log((error))
            })
    </script>
</body>
</html>